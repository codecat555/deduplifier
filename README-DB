11/17/2020

Just got the postgres db connection working (postgres listening on 5432, which is mapped to 6881 on the vm host and 6881 on the main host (the host on which the host vm runs).

From the main host (nuage):

    me@nuage:~/Documents/dev$ psql -h 10.127.208.171 -p 6881 -U postgres deduplifier

From the main host, connect on the libvirt vm host :

    me@nuage:~/Documents/dev/deduplifier$ multipass exec deduplifier-host -- psql -h localhost -p 6881 -U postgres deduplifier

From the main host, connect on the libvirt vm host via docker:

    me@nuage:~/Documents/dev/deduplifier$ multipass exec deduplifier-host -- sudo docker exec -it code_db_1 psql -h localhost -p 5432 -U postgres deduplifier

From the docker web host:

- first, find the ip address (there must be a better way...)

me@nuage:~/Documents/dev$ multipass exec deduplifier-host -- sudo iptables -t nat -L -v | grep 3368
    0     0 MASQUERADE  tcp  --  any    any     172.23.0.3           172.23.0.3           tcp dpt:3368
    4   240 DNAT       tcp  --  !br-9454511a5daf any     anywhere             anywhere             tcp dpt:6881 to:172.23.0.3:3368
me@nuage:~/Documents/dev$

- second, connect to the db

me@nuage:~/Documents/dev$ multipass exec deduplifier-host -- sudo docker exec -it deduplifier_web_1 psql -h 172.23.0.3 -p 3368 -U postgres deduplifier
Password for user postgres:
psql (12.4, server 13.1 (Debian 13.1-1.pgdg100+1))
WARNING: psql major version 12, server major version 13.
         Some psql features might not work.
Type "help" for help.

deduplifier=# \d
               List of relations
 Schema |      Name       |   Type   |  Owner
--------+-----------------+----------+----------
 public | file            | table    | postgres
 public | file_id_seq     | sequence | postgres
 public | location        | table    | postgres
 public | location_id_seq | sequence | postgres
(4 rows)

deduplifier=#


