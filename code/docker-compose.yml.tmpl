version: "3.8"
services:
  web:
    restart: always
    build:
        context: .
        dockerfile: web-Dockerfile
        args:
            port: ___WEB_INSTANCE_PORT___
    volumes:
      - .:___CODE_PATH___
    ports:
      - "___WEB_EXTERNAL_PORT___:___WEB_INSTANCE_PORT___"
    depends_on:
      - db

  db:
    restart: always
    build:
        context: .
        dockerfile: db-Dockerfile
#        args:
#            port: ___DB_INSTANCE_PORT___
    image: postgres
    environment:
      - PGDATA=/app/db
#      - PGPORT=___DB_INSTANCE_PORT___
      - POSTGRES_DB=___APP_NAME___
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - PGSETUP_INITDB_OPTIONS="--auth=trust"
    ports:
      - "___DB_EXTERNAL_PORT___:___DB_INSTANCE_PORT___"

  redis:
      image: "redis:alpine"

